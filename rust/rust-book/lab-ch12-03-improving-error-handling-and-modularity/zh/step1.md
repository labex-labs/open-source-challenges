# 重构以提高模块化和错误处理能力

为了改进我们的程序，我们将修复与程序结构以及它如何处理潜在错误相关的四个问题。首先，我们的 `main` 函数现在执行两项任务：解析参数和读取文件。随着程序的发展，`main` 函数处理的单独任务数量将会增加。随着一个函数承担的职责增多，它会变得更难理解、更难测试，并且在不破坏其某个部分的情况下更难更改。最好将功能分开，以便每个函数负责一项任务。

这个问题还与第二个问题相关：尽管 `query` 和 `file_path` 是我们程序的配置变量，但像 `contents` 这样的变量却用于执行程序的逻辑。`main` 函数变得越长，我们需要引入作用域的变量就越多；我们在作用域中拥有的变量越多，就越难跟踪每个变量的用途。最好将配置变量分组到一个结构体中，以使它们的用途清晰明了。

第三个问题是，当读取文件失败时，我们使用 `expect` 来打印错误消息，但错误消息只打印 `Should have been able to read the file`。读取文件可能会以多种方式失败：例如，文件可能缺失，或者我们可能没有权限打开它。目前，无论情况如何，我们都会为所有情况打印相同的错误消息，这不会给用户提供任何信息！

第四，我们多次使用 `expect` 来处理不同的错误，如果用户在没有指定足够参数的情况下运行我们的程序，他们会从 Rust 得到一个 `index out of bounds` 错误，这个错误没有清楚地解释问题。如果所有的错误处理代码都在一个地方，那么如果错误处理逻辑需要更改，未来的维护者只需要在一个地方查阅代码就好了。将所有的错误处理代码放在一个地方还将确保我们打印的消息对最终用户有意义。

让我们通过重构项目来解决这四个问题。
