# 二进制项目的关注点分离

将多个任务的职责分配给 `main` 函数的组织问题在许多二进制项目中都很常见。因此，当 `main` 函数开始变得庞大时，Rust 社区已经制定了一些准则来拆分二进制程序的不同关注点。这个过程包括以下步骤：

- 将你的程序拆分为一个 `main.rs` 文件和一个 `lib.rs` 文件，并将程序的逻辑移动到 `lib.rs` 中。
- 只要你的命令行解析逻辑比较简单，它可以保留在 `main.rs` 中。
- 当命令行解析逻辑开始变得复杂时，将其从 `main.rs` 中提取出来并移动到 `lib.rs` 中。

在此过程之后，保留在 `main` 函数中的职责应仅限于以下几点：

- 使用参数值调用命令行解析逻辑。
- 设置任何其他配置。
- 调用 `lib.rs` 中的 `run` 函数。
- 如果 `run` 返回错误，则处理该错误。

这种模式是关于分离关注点：`main.rs` 负责运行程序，而 `lib.rs` 负责处理手头任务的所有逻辑。由于你不能直接测试 `main` 函数，这种结构允许你通过将所有程序逻辑移动到 `lib.rs` 中的函数来进行测试。保留在 `main.rs` 中的代码将足够小，可以通过阅读来验证其正确性。让我们按照这个过程来重构我们的程序。
